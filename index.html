<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="moment.js"></script>
    <link rel="stylesheet" href="twittler.css"></link>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  </head>
  <body>
    

    <script>
     
      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        var $header = $('<h1>Twittler</hi>')
        $header.appendTo($body);
        
        
        var $feed = $('<div id="feed"></div>');
        $feed.appendTo($body);
        
        var getIndex= function(){
          return streams.home.length - 1;
        }
        
        var index = getIndex();
        var count = getIndex();
        var totalTweets = 0;

        var makeTweet = function(tweet){
          var $tweet = $('<div class="tweet"></div>');
          var $user = $('<div class="user"></div>');
          var $timestamp = $('<div class="time"></div>');
          var time_formatted = moment().format('MMMM Do YYYY, h:mm:ss a').toString();
          var $tweetBox = $('<div class="tweetBox"></div>');

          var username = tweet.user;
          var $userTag = $('<div class=' + username + '></div>');

          $timestamp.text(time_formatted);
          $user.text(tweet.user);
          $tweet.text(tweet.message);

          
          $user.appendTo($tweetBox);
          $tweet.appendTo($tweetBox);
          $timestamp.appendTo($tweetBox);
          $userTag.appendTo($tweetBox);
          $tweetBox.prependTo($feed);
          //return $tweetBox;
        }; 

        var loadTweets = function(index, count){
        while(index > count){
          var tweet = streams.home[index];
          tweetBox = makeTweet(tweet);
          //tweetBox.prependTo($feed);
          
          index -= 1;
          totalTweets ++ ;

          $('.tweetBox').on('click', '.user', function() {
            $(this).css('background-color', '#252b30');
            $(this).css('border-color', '1px solid #967');
            var thisUser = $(this).text();
            $( ".tweetBox" ).not( "."+thisUser ).remove();
            //$(this).parent().parent().remove();
            
            getUserTweets(thisUser);
            
          });
          // $('.user').on('click', function() {
          //   var thisUser = $(".user").text();
          //   $('.feed').filter("."+thisUser);
          //   //getUserTweets(thisUser);
          // });

        }
        };

        //getStarted();
        loadTweets(index, -1);

        setInterval(function(){
          var newindex = getIndex();
          loadTweets(newindex, count);
        
          count=getIndex();
        }, 60000);

        var getUserTweets = function(username){
          var tweetArray=streams.home.slice(0, totalTweets);
          for (var i=0; i < tweetArray.length; i++){
            if (tweetArray[i].user==username){
              makeTweet(tweetArray[i]);
            }
          }
        };


      });

    </script>
    
  </body>
</html>
